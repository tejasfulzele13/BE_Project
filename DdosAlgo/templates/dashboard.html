<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Attack Traffic Monitor</title>
</head>
<body style="font-family: 'Arial', sans-serif; background-color: #347b8d; margin: 0; padding: 20px; text-align: center;">

    <div style="background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1); max-width: 1200px; margin: auto;">
        <h2 style="color: #13bd98; margin-bottom: 20px;">Live Attack Traffic Monitor</h2>
        
        <button onclick="clearLogs()" style="background-color: #04724d; color: white; border: none; padding: 10px 15px; font-size: 16px; border-radius: 4px; cursor: pointer; transition: background-color 0.3s ease; margin-bottom: 15px;">
            Clear Logs
        </button>

        <table style="width: 100%; border-collapse: collapse; margin-top: 10px;">
            <thead>
                <tr>
                    <th style="background-color: #13bd98; color: white; padding: 10px; border: 1px solid #ccc;">#</th>
                    <th style="background-color: #13bd98; color: white; padding: 10px; border: 1px solid #ccc;">Timestamp</th>
                    <th style="background-color: #13bd98; color: white; padding: 10px; border: 1px solid #ccc;">Source Port</th>
                    <th style="background-color: #13bd98; color: white; padding: 10px; border: 1px solid #ccc;">Destination Port</th>
                    <th style="background-color: #13bd98; color: white; padding: 10px; border: 1px solid #ccc;">Packet Size</th>
                    <th style="background-color: #13bd98; color: white; padding: 10px; border: 1px solid #ccc;">Packet Rate</th>
                    <th style="background-color: #13bd98; color: white; padding: 10px; border: 1px solid #ccc;">Connection Duration</th>
                    <th style="background-color: #13bd98; color: white; padding: 10px; border: 1px solid #ccc;">Protocol</th>
                    <th style="background-color: #13bd98; color: white; padding: 10px; border: 1px solid #ccc;">Request Type</th>
                    <th style="background-color: #13bd98; color: white; padding: 10px; border: 1px solid #ccc;">Anomaly Score</th>
                    <th style="background-color: #13bd98; color: white; padding: 10px; border: 1px solid #ccc;">Prediction</th>
                    <th style="background-color: #13bd98; color: white; padding: 10px; border: 1px solid #ccc;">Status</th>
                </tr>
            </thead>
            <tbody id="logTableBody">
                <!-- Logs will be inserted here -->
            </tbody>
        </table>
    </div>

    <script>
        async function fetchTrafficLogs() {
            try {
                let response = await fetch("/get_traffic_logs/");
                let data = await response.json();
                let logs = data.logs;

                let tableBody = document.getElementById("logTableBody");
                tableBody.innerHTML = "";

                logs.forEach((log, index) => {
                    let isNormalTraffic = log.prediction.toLowerCase() === "normal traffic";
                    let predictionColor = isNormalTraffic ? "black" : "red";
                    let statusText = isNormalTraffic ? "Allowed" : "Blocked";
                    let statusColor = isNormalTraffic ? "black" : "red";

                    let row = `<tr style="background-color: ${index % 2 === 0 ? '#f2f2f2' : '#d1f0e0'};">
                        <td style="padding: 10px; border: 1px solid #ccc;">${index + 1}</td>
                        <td style="padding: 10px; border: 1px solid #ccc;">${log.timestamp}</td>
                        <td style="padding: 10px; border: 1px solid #ccc;">${log.source_port}</td>
                        <td style="padding: 10px; border: 1px solid #ccc;">${log.destination_port}</td>
                        <td style="padding: 10px; border: 1px solid #ccc;">${log.packet_size}</td>
                        <td style="padding: 10px; border: 1px solid #ccc;">${log.packet_rate}</td>
                        <td style="padding: 10px; border: 1px solid #ccc;">${log.connection_duration}</td>
                        <td style="padding: 10px; border: 1px solid #ccc;">${log.protocol}</td>
                        <td style="padding: 10px; border: 1px solid #ccc;">${log.request_type}</td>
                        <td style="padding: 10px; border: 1px solid #ccc;">${log.anomaly_score}</td>
                        <td style="padding: 10px; border: 1px solid #ccc; font-weight: bold; color: ${predictionColor};">${log.prediction}</td>
                        <td style="padding: 10px; border: 1px solid #ccc; font-weight: bold; color: ${statusColor};">${statusText}</td>
                    </tr>`;

                    tableBody.innerHTML += row;
                });
            } catch (error) {
                console.error("Error fetching logs:", error);
            }
        }

        async function clearLogs() {
            try {
                let response = await fetch("/clear_logs/", { method: "POST" });
                let data = await response.json();
                
                if (response.status === 200) {
                    alert("Logs cleared successfully!");
                    document.getElementById("logTableBody").innerHTML = "";
                } else {
                    alert("Error clearing logs: " + data.error);
                }
            } catch (error) {
                console.error("Error clearing logs:", error);
            }
        }

        // Fetch logs every 5 seconds
        setInterval(fetchTrafficLogs, 5000);
    </script>

</body>
</html>
